<!-- Bot√≥n de Notificaciones con Badge -->
<div class="notifications-wrapper">
  <button 
    class="notifications-button" 
    (click)="toggle()"
    [class.has-unread]="unreadCount() > 0"
  >
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
    </svg>
    
    @if (unreadCount() > 0) {
      <span class="badge">{{ unreadCount() }}</span>
    }
  </button>

  <!-- Panel Dropdown -->
  @if (isOpen()) {
    <div class="notifications-panel" (click)="$event.stopPropagation()">
      
      <!-- Header -->
      <div class="panel-header">
        <h3 class="panel-title">
          üîî Notificaciones
          @if (unreadCount() > 0) {
            <span class="unread-indicator">({{ unreadCount() }} nuevas)</span>
          }
        </h3>
        
        <div class="panel-actions">
          @if (notifications().length > 0) {
            <button 
              class="action-btn" 
              (click)="markAllAsRead()"
              title="Marcar todas como le√≠das"
            >
              ‚úì Todas
            </button>
            <button 
              class="action-btn" 
              (click)="clearAll()"
              title="Limpiar todas"
            >
              üóëÔ∏è
            </button>
          }
          <button 
            class="action-btn close-btn" 
            (click)="close()"
            title="Cerrar"
          >
            ‚úï
          </button>
        </div>
      </div>

      <!-- Notificaciones List -->
      <div class="panel-body">
        @if (notifications().length === 0) {
          <div class="empty-state">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
            </svg>
            <p>No hay notificaciones</p>
          </div>
        } @else {
          <div class="notifications-list">
            @for (notification of notifications(); track notification.id) {
              <div 
                class="notification-item" 
                [class.unread]="!notification.read"
                (click)="markAsRead(notification.id)"
              >
                <div class="notification-icon">
                  {{ getIcon(notification.type) }}
                </div>
                
                <div class="notification-content">
                  <h4 class="notification-title">{{ notification.title }}</h4>
                  <p class="notification-message">{{ notification.message }}</p>
                  <span class="notification-time">{{ getRelativeTime(notification.timestamp) }}</span>
                </div>

                @if (!notification.read) {
                  <div class="notification-indicator"></div>
                }
              </div>
            }
          </div>
        }
      </div>

      <!-- Footer -->
      @if (notifications().length > 0) {
        <div class="panel-footer">
          <button class="view-all-btn">
            Ver todas las notificaciones
          </button>
        </div>
      }
    </div>
  }
</div>

<!-- Overlay para cerrar al click fuera -->
@if (isOpen()) {
  <div class="notifications-overlay" (click)="close()"></div>
}
