<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="brand" (click)="navigateToHome()">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
          <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <span>SGD - Dashboard</span>
      </div>
      
      <div class="user-menu">
        <div class="user-info">
          <span class="user-name">{{ userName() }}</span>
          <span class="user-role">{{ userRole() }} - {{ userArea() }}</span>
        </div>
        <button class="btn-logout" (click)="onLogout()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
          </svg>
          Cerrar Sesión
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">
    
    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-header">
          <span>Total Documentos</span>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
        </div>
        <div class="stat-value">{{ stats().total }}</div>
      </div>

      <div class="stat-card stat-recibidos">
        <div class="stat-header">
          <span>Recibidos</span>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
        </div>
        <div class="stat-value">{{ stats().recibidos }}</div>
      </div>

      <div class="stat-card stat-proceso">
        <div class="stat-header">
          <span>En Proceso</span>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <div class="stat-value">{{ stats().enProceso }}</div>
      </div>

      <div class="stat-card stat-finalizados">
        <div class="stat-header">
          <span>Finalizados</span>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <div class="stat-value">{{ stats().finalizados }}</div>
      </div>

      <div class="stat-card stat-urgentes">
        <div class="stat-header">
          <span>Urgentes</span>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
        </div>
        <div class="stat-value">{{ stats().urgentes }}</div>
      </div>
    </div>

    <!-- Filters & Table Section -->
    <div class="documents-section">
      <div class="section-header">
        <h2>Gestión de Documentos</h2>
        <button class="btn-refresh" (click)="loadDocuments()" [disabled]="loading()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
          {{ loading() ? 'Cargando...' : 'Actualizar' }}
        </button>
      </div>

      <!-- Filters -->
      <div class="filters-container">
        <div class="filter-group">
          <input 
            type="text" 
            placeholder="Buscar por código, asunto o remitente..."
            [(ngModel)]="searchTerm"
            (input)="applyFilters()"
            class="filter-search"
          />
        </div>
        
        <div class="filter-group">
          <select [(ngModel)]="statusFilter" (change)="applyFilters()" class="filter-select">
            <option value="">Todos los estados</option>
            <option value="Recibido">Recibido</option>
            <option value="En proceso">En proceso</option>
            <option value="Finalizado">Finalizado</option>
            <option value="Atendido">Atendido</option>
          </select>
        </div>

        <div class="filter-group">
          <select [(ngModel)]="priorityFilter" (change)="applyFilters()" class="filter-select">
            <option value="">Todas las prioridades</option>
            <option value="baja">Baja</option>
            <option value="normal">Normal</option>
            <option value="alta">Alta</option>
            <option value="urgente">Urgente</option>
          </select>
        </div>

        <button class="btn-clear" (click)="clearFilters()" *ngIf="searchTerm || statusFilter || priorityFilter">
          Limpiar filtros
        </button>
      </div>

      <!-- Documents Table -->
      <div class="table-container">
        <div class="loading-state" *ngIf="loading()">
          <div class="spinner"></div>
          <p>Cargando documentos...</p>
        </div>

        <div class="empty-state" *ngIf="!loading() && filteredDocuments().length === 0">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <p>No se encontraron documentos</p>
        </div>

        <table class="documents-table" *ngIf="!loading() && filteredDocuments().length > 0">
          <thead>
            <tr>
              <th>Código</th>
              <th>Asunto</th>
              <th>Remitente</th>
              <th>Tipo</th>
              <th>Estado</th>
              <th>Prioridad</th>
              <th>Área Actual</th>
              <th>Fecha</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let doc of filteredDocuments()" (click)="viewDocument(doc)">
              <td class="code">{{ doc.trackingCode }}</td>
              <td class="subject">{{ doc.asunto }}</td>
              <td>{{ doc.sender.nombreCompleto }}</td>
              <td>{{ doc.documentType.nombre }}</td>
              <td>
                <span class="status-badge" [style.background-color]="doc.status.color">
                  {{ doc.status.nombre }}
                </span>
              </td>
              <td>
                <span class="priority-badge" [ngClass]="getPriorityClass(doc.prioridad)">
                  {{ getPriorityLabel(doc.prioridad) }}
                </span>
              </td>
              <td>{{ doc.currentArea.nombre }}</td>
              <td class="date">{{ formatDate(doc.created_at) }}</td>
              <td>
                <button class="btn-view" (click)="viewDocument(doc); $event.stopPropagation()" title="Ver detalles">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </main>
</div>
