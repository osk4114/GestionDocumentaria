<div class="modal-overlay" (click)="close()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div>
        <h2 class="modal-title">ğŸ“¤ Derivar Documento</h2>
        <p class="modal-subtitle">{{ documentCode }} - {{ documentSubject }}</p>
      </div>
      <button class="modal-close" (click)="close()">âœ•</button>
    </div>

    <div class="modal-body">
      @if (errorMessage()) {
        <div class="alert alert-error">
          âœ— {{ errorMessage() }}
        </div>
      }

      <!-- Ãrea actual -->
      <div class="info-box">
        <span class="info-label">ğŸ“ Ãrea actual:</span>
        <span class="info-value">{{ currentArea }}</span>
      </div>

      <!-- Seleccionar Ã¡rea destino -->
      <div class="form-group">
        <label class="form-label">
          Ãrea de destino <span class="required">*</span>
        </label>
        <select 
          [(ngModel)]="formData().toAreaId"
          (ngModelChange)="onAreaChange()"
          class="form-select"
        >
          <option [value]="0" disabled>Seleccionar Ã¡rea...</option>
          @for (area of areas(); track area.id) {
            <option [value]="area.id">
              {{ area.nombre }} ({{ area.sigla }})
            </option>
          }
        </select>
        <p class="form-hint">Selecciona el Ã¡rea a la que deseas derivar el documento</p>
      </div>

      <!-- ObservaciÃ³n -->
      <div class="form-group">
        <label class="form-label">
          ObservaciÃ³n <span class="required">*</span>
        </label>
        <textarea 
          [(ngModel)]="formData().observacion"
          class="form-textarea"
          rows="4"
          placeholder="Motivo de la derivaciÃ³n, instrucciones o comentarios..."
        ></textarea>
        <p class="form-hint">Describe el motivo de la derivaciÃ³n</p>
      </div>

      <!-- Resumen -->
      @if (formData().toAreaId) {
        <div class="summary-box">
          <h4 class="summary-title">ğŸ“‹ Resumen de la derivaciÃ³n</h4>
          <div class="summary-item">
            <span class="summary-label">De:</span>
            <span class="summary-value">{{ currentArea }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">A:</span>
            <span class="summary-value">{{ getAreaName(formData().toAreaId) }}</span>
          </div>
        </div>
      }
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="close()" [disabled]="loading()">
        Cancelar
      </button>
      <button 
        class="btn-primary" 
        (click)="derive()"
        [disabled]="loading() || !formData().toAreaId || !formData().observacion"
      >
        @if (loading()) {
          <span class="spinner-small"></span>
        }
        ğŸ“¤ Derivar Documento
      </button>
    </div>
  </div>
</div>
