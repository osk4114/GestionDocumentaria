<div class="categories-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <button class="btn-back" (click)="goBack()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      </button>
      <div class="header-title">
        <h1>Categorías de {{ userArea()?.nombre || 'Área' }}</h1>
        <p>Gestiona las categorías de documentos de tu área</p>
      </div>
    </div>
    <button class="btn-create" (click)="openCreateModal()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
      </svg>
      Nueva Categoría
    </button>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando categorías...</p>
    </div>
  }

  <!-- Empty State -->
  @else if (categories().length === 0) {
    <div class="empty-state">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
      </svg>
      <h3>No hay categorías creadas</h3>
      <p>Crea tu primera categoría para organizar los documentos de tu área</p>
      <button class="btn-primary" (click)="openCreateModal()">
        Crear Primera Categoría
      </button>
    </div>
  }

  <!-- Categories Grid -->
  @else {
    <div class="categories-grid">
      @for (category of categories(); track category.id) {
        <div class="category-card" [class.inactive]="!category.isActive">
          <div class="card-header" [style.border-left-color]="category.color">
            <div class="category-info">
              <div class="category-color" [style.background-color]="category.color"></div>
              <div class="category-details">
                <h3 class="category-name">{{ category.nombre }}</h3>
                <span class="category-code">{{ category.codigo }}</span>
              </div>
            </div>
            <div class="category-status">
              <span class="status-badge" [class.active]="category.isActive">
                {{ category.isActive ? 'Activa' : 'Inactiva' }}
              </span>
            </div>
          </div>

          <div class="card-body">
            @if (category.descripcion) {
              <p class="category-description">{{ category.descripcion }}</p>
            }
            
          </div>

          <div class="card-actions">
            <button 
              class="btn-action btn-edit" 
              (click)="openEditModal(category)"
              [title]="'Editar ' + category.nombre"
            >
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
              </svg>
            </button>
            <button 
              class="btn-action btn-toggle" 
              (click)="toggleCategory(category)"
              [title]="category.isActive ? 'Desactivar' : 'Activar'"
            >
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
              </svg>
            </button>
            <button 
              class="btn-action btn-delete" 
              (click)="deleteCategory(category)"
              title="Eliminar"
            >
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
              </svg>
            </button>
          </div>
        </div>
      }
    </div>
  }

  <!-- Modal Create/Edit -->
  @if (showModal()) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>{{ isEditing() ? 'Editar Categoría' : 'Nueva Categoría' }}</h2>
          <button class="btn-close" (click)="closeModal()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <div class="modal-body">
          <div class="form-group">
            <label for="nombre">Nombre <span class="required">*</span></label>
            <input 
              type="text" 
              id="nombre"
              [value]="categoryForm().nombre"
              (input)="updateFormField('nombre', $any($event.target).value)"
              placeholder="Ej: Licencias, Contratos, Urgente"
              maxlength="100"
            >
          </div>

          <div class="form-group">
            <label for="codigo">Código <span class="required">*</span></label>
            <input 
              type="text" 
              id="codigo"
              [value]="categoryForm().codigo"
              (input)="updateFormField('codigo', $any($event.target).value)"
              placeholder="Ej: LIC, CONT, URG"
              maxlength="10"
              style="text-transform: uppercase;"
            >
          </div>

          <div class="form-group">
            <label>Color <span class="required">*</span></label>
            <div class="color-picker">
              @for (colorOption of colorOptions; track colorOption.value) {
                <button 
                  class="color-option"
                  [class.selected]="categoryForm().color === colorOption.value"
                  [style.background-color]="colorOption.value"
                  (click)="updateFormField('color', colorOption.value)"
                  [title]="colorOption.name"
                  type="button"
                >
                  @if (categoryForm().color === colorOption.value) {
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                    </svg>
                  }
                </button>
              }
            </div>
          </div>

          <div class="form-group">
            <label for="descripcion">Descripción</label>
            <textarea 
              id="descripcion"
              [value]="categoryForm().descripcion"
              (input)="updateFormField('descripcion', $any($event.target).value)"
              placeholder="Describe el propósito de esta categoría y qué tipo de documentos incluye"
              rows="3"
              maxlength="500"
            ></textarea>
          </div>

          @if (isEditing()) {
            <div class="form-group checkbox-group">
              <label class="checkbox-label">
                <input 
                  type="checkbox"
                  [checked]="categoryForm().isActive"
                  (change)="updateFormField('isActive', $any($event.target).checked)"
                >
                <span>Categoría activa</span>
              </label>
            </div>
          }
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeModal()">
            Cancelar
          </button>
          <button class="btn btn-primary" (click)="saveCategory()">
            {{ isEditing() ? 'Guardar Cambios' : 'Crear Categoría' }}
          </button>
        </div>
      </div>
    </div>
  }
</div>
