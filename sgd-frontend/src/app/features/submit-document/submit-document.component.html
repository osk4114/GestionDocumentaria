<div class="submit-document-container">
  <!-- Header / Navbar -->
  <header class="page-header">
    <div class="header-content">
      <div class="logo-section">
        <img src="images/gb1.svg" alt="Logo Gobierno del Perú" class="logo-image" (click)="navigateToLanding()" style="cursor: pointer;">
        <div class="separator"></div>
        <div class="entity-info">
          <span class="entity-name">Dirección Regional de Transportes y Comunicaciones - Puno</span>
        </div>
      </div>
    </div>
  </header>

  <div class="content-wrapper">
    
    @if (submitSuccess()) {
      <!-- Mensaje de Éxito -->
      <div class="success-message">
        <div class="success-icon">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <div class="success-content">
          <h3>¡Documento registrado exitosamente!</h3>
          <div class="tracking-info">
            <p class="tracking-code">Código de seguimiento: <strong>{{ trackingCode() }}</strong></p>
            <p class="tracking-note">Guarde este código para consultar el estado de su trámite.</p>
          </div>
          <div class="success-actions">
            <button (click)="resetForm()" class="btn btn-primary">
              Registrar otro documento
            </button>
            <a [href]="'/track?code=' + trackingCode()" class="btn btn-secondary">
              Consultar estado
            </a>
          </div>
        </div>
      </div>
    } @else {
      <!-- Header -->
      <div class="header">
        <h1 class="title">Mesa de partes</h1>
        <div class="info-box">
          <p>¡Hola!</p>
          <p>Puedes enviar tus documentos las 24 horas del día, los 7 días de la semana. Ten en cuenta que el plazo de atención comenzará a ser contado a partir del siguiente día hábil en que lo enviaste, dentro de nuestro horario de atención regular.</p>
          <p>Para más información, puedes visitar nuestra página web <a href="https://www.gob.pe/drtcp" target="_blank" class="link">www.gob.pe/drtcp</a>.</p>
          <p class="italic">¡Muy pronto, nuevos servicios digitales!</p>
        </div>
      </div>

      <!-- Mensaje de Error -->
      @if (errorMessage()) {
        <div class="error-message">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span>{{ errorMessage() }}</span>
        </div>
      }

      <!-- Formulario Único -->
      <form [formGroup]="documentForm" class="form-card">
        
        <!-- Información del Solicitante -->
        <div class="form-section">
          <h2 class="section-title">Información del solicitante</h2>
          
          <div class="form-group">
            <label class="step-label">1. Persona natural o jurídica</label>
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" formControlName="tipoPersona" value="natural">
                <span>Persona natural</span>
              </label>
              <label class="radio-label">
                <input type="radio" formControlName="tipoPersona" value="juridica">
                <span>Persona jurídica</span>
              </label>
            </div>
          </div>

          <!-- Campos para Persona Natural -->
          @if (documentForm.get('tipoPersona')?.value === 'natural') {
            <div class="conditional-section">
              <div class="form-row">
                <div class="form-group">
                  <label for="tipoDocumentoNatural">
                    1.1. Tipo de documento de identidad del solicitante 
                    <span class="optional">(Opcional)</span>
                  </label>
                  <select id="tipoDocumentoNatural" formControlName="tipoDocumentoNatural">
                    <option value="DNI">DNI</option>
                    <option value="CE">Carné de Extranjería</option>
                    <option value="Pasaporte">Pasaporte</option>
                  </select>
                </div>
              </div>

              <div class="form-group" [class.has-error]="hasError('numeroDocumentoNatural')" [class.is-valid]="isValid('numeroDocumentoNatural')">
                <label for="numeroDocumentoNatural">
                  Número de documento de identidad del solicitante 
                  <span class="required">*</span>
                </label>
                <div class="input-wrapper">
                  <input 
                    id="numeroDocumentoNatural"
                    type="text" 
                    formControlName="numeroDocumentoNatural"
                    placeholder="Ej: 12345678"
                    maxlength="9">
                  @if (isValid('numeroDocumentoNatural')) {
                    <span class="icon-valid">✓</span>
                  }
                </div>
                @if (hasError('numeroDocumentoNatural')) {
                  <span class="error-text">{{ getErrorMessage('numeroDocumentoNatural') }}</span>
                }
              </div>

              <div class="form-group">
                <label class="subsection-label">1.2. Nombres y apellidos del solicitante</label>
                <div class="form-row-3">
                  <div class="form-col" [class.has-error]="hasError('nombres')" [class.is-valid]="isValid('nombres')">
                    <label for="nombres">
                      Nombres <span class="required">*</span>
                    </label>
                    <div class="input-wrapper">
                      <input 
                        id="nombres"
                        type="text" 
                        formControlName="nombres"
                        placeholder="Ej: Juan Carlos">
                      @if (isValid('nombres')) {
                        <span class="icon-valid">✓</span>
                      }
                    </div>
                    @if (hasError('nombres')) {
                      <span class="error-text">{{ getErrorMessage('nombres') }}</span>
                    }
                  </div>
                  
                  <div class="form-col" [class.has-error]="hasError('apellidoPaterno')" [class.is-valid]="isValid('apellidoPaterno')">
                    <label for="apellidoPaterno">
                      Apellido paterno <span class="required">*</span>
                    </label>
                    <div class="input-wrapper">
                      <input 
                        id="apellidoPaterno"
                        type="text" 
                        formControlName="apellidoPaterno"
                        placeholder="Ej: García">
                      @if (isValid('apellidoPaterno')) {
                        <span class="icon-valid">✓</span>
                      }
                    </div>
                    @if (hasError('apellidoPaterno')) {
                      <span class="error-text">{{ getErrorMessage('apellidoPaterno') }}</span>
                    }
                  </div>
                  
                  <div class="form-col" [class.has-error]="hasError('apellidoMaterno')" [class.is-valid]="isValid('apellidoMaterno')">
                    <label for="apellidoMaterno">
                      Apellido materno <span class="required">*</span>
                    </label>
                    <div class="input-wrapper">
                      <input 
                        id="apellidoMaterno"
                        type="text" 
                        formControlName="apellidoMaterno"
                        placeholder="Ej: López">
                      @if (isValid('apellidoMaterno')) {
                        <span class="icon-valid">✓</span>
                      }
                    </div>
                    @if (hasError('apellidoMaterno')) {
                      <span class="error-text">{{ getErrorMessage('apellidoMaterno') }}</span>
                    }
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label class="subsection-label">1.3. Dirección actual</label>
                <div class="form-row-3">
                  <div class="form-col">
                    <label for="departamento">Departamento</label>
                    <select id="departamento" formControlName="departamento">
                      <option value="">Selecciona un departamento</option>
                      @for (depto of departamentos(); track depto) {
                        <option [value]="depto">{{ depto }}</option>
                      }
                    </select>
                  </div>
                  <div class="form-col">
                    <label for="provincia">Provincia</label>
                    <select id="provincia" formControlName="provincia">
                      <option value="">Selecciona una provincia</option>
                      @for (prov of provincias(); track prov) {
                        <option [value]="prov">{{ prov }}</option>
                      }
                    </select>
                  </div>
                  <div class="form-col">
                    <label for="distrito">Distrito</label>
                    <select id="distrito" formControlName="distrito">
                      <option value="">Selecciona un distrito</option>
                      @for (dist of distritos(); track dist) {
                        <option [value]="dist">{{ dist }}</option>
                      }
                    </select>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="direccion">1.4. Escribe la dirección</label>
                <input 
                  id="direccion"
                  type="text" 
                  formControlName="direccion"
                  placeholder="">
              </div>
            </div>
          }

          <!-- Campos para Persona Jurídica -->
          @if (documentForm.get('tipoPersona')?.value === 'juridica') {
            <div class="conditional-section">
              <h3 class="subsection-title">Información de la entidad, empresa o institución</h3>
              
              <div class="form-group" [class.has-error]="hasError('ruc')" [class.is-valid]="isValid('ruc')">
                <label for="ruc">
                  1.1. Ingresa el número de RUC <span class="required">*</span>
                </label>
                <div class="input-wrapper">
                  <input 
                    id="ruc"
                    type="text" 
                    formControlName="ruc"
                    placeholder="Ej: 20123456789"
                    maxlength="11">
                  @if (isValid('ruc')) {
                    <span class="icon-valid">✓</span>
                  }
                </div>
                @if (hasError('ruc')) {
                  <span class="error-text">{{ getErrorMessage('ruc') }}</span>
                }
              </div>

              <div class="form-group" [class.has-error]="hasError('nombreEmpresa')" [class.is-valid]="isValid('nombreEmpresa')">
                <label for="nombreEmpresa">
                  1.2. Nombre de la entidad, empresa o institución <span class="required">*</span>
                </label>
                <div class="input-wrapper">
                  <input 
                    id="nombreEmpresa"
                    type="text" 
                    formControlName="nombreEmpresa"
                    placeholder="Ej: Corporación ABC S.A.C.">
                  @if (isValid('nombreEmpresa')) {
                    <span class="icon-valid">✓</span>
                  }
                </div>
                @if (hasError('nombreEmpresa')) {
                  <span class="error-text">{{ getErrorMessage('nombreEmpresa') }}</span>
                }
              </div>

              <div class="form-group">
                <label class="subsection-label">1.3. Dirección de la entidad, empresa o institución</label>
                <div class="form-row-3">
                  <div class="form-col">
                    <label for="departamento">Departamento</label>
                    <select id="departamento" formControlName="departamento">
                      <option value="">Selecciona un departamento</option>
                      @for (depto of departamentos(); track depto) {
                        <option [value]="depto">{{ depto }}</option>
                      }
                    </select>
                  </div>
                  <div class="form-col">
                    <label for="provincia">Provincia</label>
                    <select id="provincia" formControlName="provincia">
                      <option value="">Selecciona una provincia</option>
                      @for (prov of provincias(); track prov) {
                        <option [value]="prov">{{ prov }}</option>
                      }
                    </select>
                  </div>
                  <div class="form-col">
                    <label for="distrito">Distrito</label>
                    <select id="distrito" formControlName="distrito">
                      <option value="">Selecciona un distrito</option>
                      @for (dist of distritos(); track dist) {
                        <option [value]="dist">{{ dist }}</option>
                      }
                    </select>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="direccion">1.4. Escribe la dirección</label>
                <input 
                  id="direccion"
                  type="text" 
                  formControlName="direccion"
                  placeholder="">
              </div>

              <h3 class="subsection-title">Información del representante legal que realiza el trámite</h3>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="tipoDocumentoRepresentante">
                    1.5. Tipo de documento de identidad del representante legal que realiza el trámite 
                    <span class="optional">(Opcional)</span>
                  </label>
                  <select id="tipoDocumentoRepresentante" formControlName="tipoDocumentoRepresentante">
                    <option value="DNI">DNI</option>
                    <option value="CE">Carné de Extranjería</option>
                    <option value="Pasaporte">Pasaporte</option>
                  </select>
                </div>
              </div>

              <div class="form-group" [class.has-error]="hasError('numeroDocumentoRepresentante')" [class.is-valid]="isValid('numeroDocumentoRepresentante')">
                <label for="numeroDocumentoRepresentante">
                  Número de documento de identidad <span class="required">*</span>
                </label>
                <div class="input-wrapper">
                  <input 
                    id="numeroDocumentoRepresentante"
                    type="text" 
                    formControlName="numeroDocumentoRepresentante"
                    placeholder="Ej: 12345678"
                    maxlength="9">
                  @if (isValid('numeroDocumentoRepresentante')) {
                    <span class="icon-valid">✓</span>
                  }
                </div>
                @if (hasError('numeroDocumentoRepresentante')) {
                  <span class="error-text">{{ getErrorMessage('numeroDocumentoRepresentante') }}</span>
                }
              </div>

              <div class="form-group">
                <label class="subsection-label">
                  1.6. Nombres y apellidos del representante legal que realiza el trámite
                </label>
                <div class="form-row-3">
                  <div class="form-col" [class.has-error]="hasError('nombresRepresentante')" [class.is-valid]="isValid('nombresRepresentante')">
                    <label for="nombresRepresentante">
                      Nombres <span class="required">*</span>
                    </label>
                    <div class="input-wrapper">
                      <input 
                        id="nombresRepresentante"
                        type="text" 
                        formControlName="nombresRepresentante"
                        placeholder="Ej: María Elena">
                      @if (isValid('nombresRepresentante')) {
                        <span class="icon-valid">✓</span>
                      }
                    </div>
                    @if (hasError('nombresRepresentante')) {
                      <span class="error-text">{{ getErrorMessage('nombresRepresentante') }}</span>
                    }
                  </div>
                  
                  <div class="form-col" [class.has-error]="hasError('apellidoPaternoRepresentante')" [class.is-valid]="isValid('apellidoPaternoRepresentante')">
                    <label for="apellidoPaternoRepresentante">
                      Apellido paterno <span class="required">*</span>
                    </label>
                    <div class="input-wrapper">
                      <input 
                        id="apellidoPaternoRepresentante"
                        type="text" 
                        formControlName="apellidoPaternoRepresentante"
                        placeholder="Ej: Rodríguez">
                      @if (isValid('apellidoPaternoRepresentante')) {
                        <span class="icon-valid">✓</span>
                      }
                    </div>
                    @if (hasError('apellidoPaternoRepresentante')) {
                      <span class="error-text">{{ getErrorMessage('apellidoPaternoRepresentante') }}</span>
                    }
                  </div>
                  
                  <div class="form-col" [class.has-error]="hasError('apellidoMaternoRepresentante')" [class.is-valid]="isValid('apellidoMaternoRepresentante')">
                    <label for="apellidoMaternoRepresentante">
                      Apellido materno <span class="required">*</span>
                    </label>
                    <div class="input-wrapper">
                      <input 
                        id="apellidoMaternoRepresentante"
                        type="text" 
                        formControlName="apellidoMaternoRepresentante"
                        placeholder="Ej: Fernández">
                      @if (isValid('apellidoMaternoRepresentante')) {
                        <span class="icon-valid">✓</span>
                      }
                    </div>
                    @if (hasError('apellidoMaternoRepresentante')) {
                      <span class="error-text">{{ getErrorMessage('apellidoMaternoRepresentante') }}</span>
                    }
                  </div>
                </div>
              </div>
            </div>
          }

          <div class="form-group" [class.has-error]="hasError('email')" [class.is-valid]="isValid('email')">
            <label for="email" class="step-label">
              2. Correo electrónico de contacto <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              <input 
                id="email"
                type="email" 
                formControlName="email"
                placeholder="Ej: correo@ejemplo.com">
              @if (isValid('email')) {
                <span class="icon-valid">✓</span>
              }
            </div>
            @if (hasError('email')) {
              <span class="error-text">{{ getErrorMessage('email') }}</span>
            }
          </div>

          <div class="form-group" [class.has-error]="hasError('telefono')" [class.is-valid]="isValid('telefono')">
            <label for="telefono" class="step-label">
              3. Teléfono o celular de contacto <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              <input 
                id="telefono"
                type="tel" 
                formControlName="telefono"
                placeholder="Ej: 987654321"
                maxlength="9">
              @if (isValid('telefono')) {
                <span class="icon-valid">✓</span>
              }
            </div>
            @if (hasError('telefono')) {
              <span class="error-text">{{ getErrorMessage('telefono') }}</span>
            }
          </div>
        </div>

        <!-- Descripción de la Solicitud -->
        <div class="form-section">
          <h2 class="section-title">Descripción de la solicitud o trámite</h2>
          
          <div class="form-group" [class.has-error]="hasError('asunto')" [class.is-valid]="isValid('asunto')">
            <label for="asunto" class="step-label">
              4. Asunto de la solicitud o trámite <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              <input 
                id="asunto"
                type="text" 
                formControlName="asunto"
                placeholder="Ej: Solicitud de certificado de estudios"
                maxlength="200">
              @if (isValid('asunto')) {
                <span class="icon-valid">✓</span>
              }
            </div>
            @if (hasError('asunto')) {
              <span class="error-text">{{ getErrorMessage('asunto') }}</span>
            }
          </div>

          <div class="form-group">
            <label for="descripcion" class="step-label">5. Descripción de la solicitud o trámite</label>
            <textarea 
              id="descripcion"
              formControlName="descripcion"
              rows="4"
              maxlength="500"
              placeholder=""></textarea>
            <div class="char-counter">{{ documentForm.get('descripcion')?.value?.length || 0 }}/500</div>
          </div>
        </div>

        <!-- Documentos de Sustento -->
        <div class="form-section">
          <h2 class="section-title">Documentos de sustento</h2>
          
          <div class="form-group">
            <label class="step-label">6. Adjunta los documentos que sustenten tu solicitud <span class="required">*</span></label>
            <p class="help-text">Solo se aceptan archivos PDF e imágenes escaneadas (jpg, jpeg, png).</p>
            <p class="help-text weight-bold">Peso total máximo: 10 MB.</p>
            
            <div class="file-upload-area" (click)="fileInput.click()">
              <div class="file-upload-icon">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
              </div>
              <p><a class="link">Selecciona los archivos</a> o arrástralos aquí</p>
            </div>
            <input 
              #fileInput
              type="file" 
              multiple
              accept=".pdf,.jpg,.jpeg,.png"
              (change)="onFileSelected($event)"
              style="display: none;">
            
            @if (selectedFiles().length > 0) {
              <div class="file-list">
                @for (file of selectedFiles(); track file.name) {
                  <div class="file-item">
                    <span>{{ file.name }} ({{ formatFileSize(file.size) }})</span>
                    <button type="button" (click)="removeFile(file)" class="remove-btn">✕</button>
                  </div>
                }
              </div>
            } @else {
              <p class="help-text" style="color: #C1272D; margin-top: 0.5rem;">⚠️ Debes adjuntar al menos un archivo para enviar tu solicitud.</p>
            }
          </div>

          <div class="form-group">
            <label for="linkDescarga" class="step-label">7. Si tus archivos pesan más de 10 MB, puedes dejamos un link de descarga <span class="optional">(Opcional)</span></label>
            <input 
              id="linkDescarga"
              type="url" 
              formControlName="linkDescarga"
              placeholder="">
          </div>
        </div>

        <!-- Checkboxes de Aceptación -->
        <div class="form-section">
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="aceptoPolitica">
              <span>Acepto la <a href="#" class="link">política de privacidad</a></span>
            </label>
          </div>

          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="aceptoDeclaracion">
              <span>Acepto la <a href="#" class="link">declaración jurada de veracidad de la información</a></span>
            </label>
          </div>
        </div>

        <!-- Botón de Enviar -->
        <div class="form-actions">
          <button 
            type="button" 
            (click)="submitDocument()" 
            class="btn btn-primary btn-large"
            [disabled]="documentForm.invalid || selectedFiles().length === 0 || loading()">
            @if (loading()) {
              <span class="loading-spinner"></span>
              Enviando...
            } @else {
              Enviar
            }
          </button>
        </div>
      </form>
    }
  </div>
</div>
