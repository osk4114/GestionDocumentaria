<div class="submit-document-container">
  <div class="content-wrapper">
    
    @if (submitSuccess()) {
      <!-- Mensaje de Éxito -->
      <div class="success-message">
        <div class="success-icon">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <div class="success-content">
          <h3>¡Documento registrado exitosamente!</h3>
          <div class="tracking-info">
            <p class="tracking-code">Código de seguimiento: <strong>{{ trackingCode() }}</strong></p>
            <p class="tracking-note">Guarde este código para consultar el estado de su trámite.</p>
          </div>
          <div class="success-actions">
            <button (click)="resetForm()" class="btn btn-primary">
              Registrar otro documento
            </button>
            <a [href]="'/track?code=' + trackingCode()" class="btn btn-secondary">
              Consultar estado
            </a>
          </div>
        </div>
      </div>
    } @else {
      <!-- Header -->
      <div class="header">
        <h1 class="title">Mesa de partes</h1>
        <div class="info-box">
          <p>¡Hola!</p>
          <p>Puedes enviar tus documentos las 24 horas del día, los 7 días de la semana. Ten en cuenta que el plazo de atención comenzará a ser contado a partir del siguiente día hábil en que lo enviaste, dentro de nuestro horario de atención regular.</p>
          <p>Para más información, puedes visitar nuestra página web <a href="https://www.gob.pe/drtcp" target="_blank" class="link">www.gob.pe/drtcp</a>.</p>
          <p class="italic">¡Muy pronto, nuevos servicios digitales!</p>
        </div>
      </div>

      <!-- Mensaje de Error -->
      @if (errorMessage()) {
        <div class="error-message">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span>{{ errorMessage() }}</span>
        </div>
      }

      <!-- Formulario Único -->
      <form [formGroup]="documentForm" class="form-card">
        
        <!-- Información del Solicitante -->
        <div class="form-section">
          <h2 class="section-title">Información del solicitante</h2>
          
          <div class="form-group">
            <label class="step-label">1. Persona natural o jurídica</label>
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" formControlName="tipoPersona" value="natural">
                <span>Persona natural</span>
              </label>
              <label class="radio-label">
                <input type="radio" formControlName="tipoPersona" value="juridica">
                <span>Persona jurídica</span>
              </label>
            </div>
          </div>

          <!-- Campos para Persona Natural -->
          @if (documentForm.get('tipoPersona')?.value === 'natural') {
            <div class="conditional-section">
              <div class="form-row">
                <div class="form-group">
                  <label for="tipoDocumentoNatural">1.1. Tipo de documento de identidad del solicitante <span class="optional">(Opcional)</span></label>
                  <select id="tipoDocumentoNatural" formControlName="tipoDocumentoNatural">
                    <option value="DNI">DNI</option>
                    <option value="CE">Carné de Extranjería</option>
                    <option value="Pasaporte">Pasaporte</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label for="numeroDocumentoNatural">Número de documento de identidad del solicitante</label>
                <input 
                  id="numeroDocumentoNatural"
                  type="text" 
                  formControlName="numeroDocumentoNatural"
                  placeholder="">
              </div>

              <div class="form-group">
                <label class="subsection-label">1.2. Nombres y apellidos del solicitante</label>
                <div class="form-row-3">
                  <div class="form-col">
                    <label for="nombres">Nombres</label>
                    <input 
                      id="nombres"
                      type="text" 
                      formControlName="nombres"
                      placeholder="">
                  </div>
                  <div class="form-col">
                    <label for="apellidoPaterno">Apellido paterno</label>
                    <input 
                      id="apellidoPaterno"
                      type="text" 
                      formControlName="apellidoPaterno"
                      placeholder="">
                  </div>
                  <div class="form-col">
                    <label for="apellidoMaterno">Apellido materno</label>
                    <input 
                      id="apellidoMaterno"
                      type="text" 
                      formControlName="apellidoMaterno"
                      placeholder="">
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label class="subsection-label">1.3. Dirección actual</label>
                <div class="form-row-3">
                  <div class="form-col">
                    <label for="departamento">Departamento</label>
                    <select id="departamento" formControlName="departamento">
                      <option value="">Selecciona un departamento</option>
                      <option value="Puno">Puno</option>
                    </select>
                  </div>
                  <div class="form-col">
                    <label for="provincia">Provincia</label>
                    <select id="provincia" formControlName="provincia">
                      <option value="">Selecciona una provincia</option>
                      <option value="Puno">Puno</option>
                    </select>
                  </div>
                  <div class="form-col">
                    <label for="distrito">Distrito</label>
                    <select id="distrito" formControlName="distrito">
                      <option value="">Selecciona un distrito</option>
                      <option value="Puno">Puno</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="direccion">1.4. Escribe la dirección</label>
                <input 
                  id="direccion"
                  type="text" 
                  formControlName="direccion"
                  placeholder="">
              </div>
            </div>
          }

          <!-- Campos para Persona Jurídica -->
          @if (documentForm.get('tipoPersona')?.value === 'juridica') {
            <div class="conditional-section">
              <h3 class="subsection-title">Información de la entidad, empresa o institución</h3>
              
              <div class="form-group">
                <label for="ruc">1.1. Ingresa el número de RUC</label>
                <input 
                  id="ruc"
                  type="text" 
                  formControlName="ruc"
                  placeholder=""
                  maxlength="11">
              </div>

              <div class="form-group">
                <label for="nombreEmpresa">1.2. Nombre de la entidad, empresa o institución</label>
                <input 
                  id="nombreEmpresa"
                  type="text" 
                  formControlName="nombreEmpresa"
                  placeholder="">
              </div>

              <div class="form-group">
                <label class="subsection-label">1.3. Dirección de la entidad, empresa o institución</label>
                <div class="form-row-3">
                  <div class="form-col">
                    <label for="departamento">Departamento</label>
                    <select id="departamento" formControlName="departamento">
                      <option value="">Selecciona un departamento</option>
                      <option value="Puno">Puno</option>
                    </select>
                  </div>
                  <div class="form-col">
                    <label for="provincia">Provincia</label>
                    <select id="provincia" formControlName="provincia">
                      <option value="">Selecciona una provincia</option>
                      <option value="Puno">Puno</option>
                    </select>
                  </div>
                  <div class="form-col">
                    <label for="distrito">Distrito</label>
                    <select id="distrito" formControlName="distrito">
                      <option value="">Selecciona un distrito</option>
                      <option value="Puno">Puno</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="direccion">1.4. Escribe la dirección</label>
                <input 
                  id="direccion"
                  type="text" 
                  formControlName="direccion"
                  placeholder="">
              </div>

              <h3 class="subsection-title">Información del representante legal que realiza el trámite</h3>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="tipoDocumentoRepresentante">1.5. Tipo de documento de identidad del representante legal que realiza el trámite <span class="optional">(Opcional)</span></label>
                  <select id="tipoDocumentoRepresentante" formControlName="tipoDocumentoRepresentante">
                    <option value="DNI">DNI</option>
                    <option value="CE">Carné de Extranjería</option>
                    <option value="Pasaporte">Pasaporte</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label for="numeroDocumentoRepresentante">Número de documento de identidad</label>
                <input 
                  id="numeroDocumentoRepresentante"
                  type="text" 
                  formControlName="numeroDocumentoRepresentante"
                  placeholder="">
              </div>

              <div class="form-group">
                <label class="subsection-label">1.6. Nombres y apellidos del representante legal que realiza el trámite <span class="optional">(Opcional)</span></label>
                <div class="form-row-3">
                  <div class="form-col">
                    <label for="nombresRepresentante">Nombres</label>
                    <input 
                      id="nombresRepresentante"
                      type="text" 
                      formControlName="nombresRepresentante"
                      placeholder="">
                  </div>
                  <div class="form-col">
                    <label for="apellidoPaternoRepresentante">Apellido paterno</label>
                    <input 
                      id="apellidoPaternoRepresentante"
                      type="text" 
                      formControlName="apellidoPaternoRepresentante"
                      placeholder="">
                  </div>
                  <div class="form-col">
                    <label for="apellidoMaternoRepresentante">Apellido materno</label>
                    <input 
                      id="apellidoMaternoRepresentante"
                      type="text" 
                      formControlName="apellidoMaternoRepresentante"
                      placeholder="">
                  </div>
                </div>
              </div>
            </div>
          }

          <div class="form-group">
            <label for="email" class="step-label">2. Correo electrónico de contacto</label>
            <input 
              id="email"
              type="email" 
              formControlName="email"
              placeholder="">
            @if (documentForm.get('email')?.invalid && documentForm.get('email')?.touched) {
              <span class="error-text">Correo electrónico inválido</span>
            }
          </div>

          <div class="form-group">
            <label for="telefono" class="step-label">3. Teléfono o celular de contacto</label>
            <input 
              id="telefono"
              type="tel" 
              formControlName="telefono"
              placeholder="">
          </div>
        </div>

        <!-- Descripción de la Solicitud -->
        <div class="form-section">
          <h2 class="section-title">Descripción de la solicitud o trámite</h2>
          
          <div class="form-group">
            <label for="asunto" class="step-label">4. Asunto de la solicitud o trámite</label>
            <input 
              id="asunto"
              type="text" 
              formControlName="asunto"
              placeholder="">
            @if (documentForm.get('asunto')?.invalid && documentForm.get('asunto')?.touched) {
              <span class="error-text">El asunto es requerido</span>
            }
          </div>

          <div class="form-group">
            <label for="descripcion" class="step-label">5. Descripción de la solicitud o trámite</label>
            <textarea 
              id="descripcion"
              formControlName="descripcion"
              rows="4"
              maxlength="500"
              placeholder=""></textarea>
            <div class="char-counter">{{ documentForm.get('descripcion')?.value?.length || 0 }}/500</div>
          </div>
        </div>

        <!-- Documentos de Sustento -->
        <div class="form-section">
          <h2 class="section-title">Documentos de sustento (opcional)</h2>
          
          <div class="form-group">
            <label class="step-label">6. Adjunta los documentos que sustenten tu solicitud <span class="optional">(Opcional)</span></label>
            <p class="help-text">Solo se aceptan formatos jpg, jpeg, png, tif, bmp, pdf, doc, docx, txt, xls, xlsx, xlsm, csv, rar, zip, mp3, wma, mp4 y wmv.</p>
            <p class="help-text weight-bold">Peso total máximo: 10 MB.</p>
            
            <div class="file-upload-area" (click)="fileInput.click()">
              <div class="file-upload-icon">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
              </div>
              <p><a class="link">Selecciona los archivos</a> o arrástralos aquí</p>
            </div>
            <input 
              #fileInput
              type="file" 
              multiple
              accept=".jpg,.jpeg,.png,.tif,.bmp,.pdf,.doc,.docx,.txt,.xls,.xlsx,.xlsm,.csv,.rar,.zip,.mp3,.wma,.mp4,.wmv"
              (change)="onFileSelected($event)"
              style="display: none;">
            
            @if (selectedFiles().length > 0) {
              <div class="file-list">
                @for (file of selectedFiles(); track file.name) {
                  <div class="file-item">
                    <span>{{ file.name }} ({{ formatFileSize(file.size) }})</span>
                    <button type="button" (click)="removeFile(file)" class="remove-btn">✕</button>
                  </div>
                }
              </div>
            }
          </div>

          <div class="form-group">
            <label for="linkDescarga" class="step-label">7. Si tus archivos pesan más de 10 MB, puedes dejamos un link de descarga <span class="optional">(Opcional)</span></label>
            <input 
              id="linkDescarga"
              type="url" 
              formControlName="linkDescarga"
              placeholder="">
          </div>
        </div>

        <!-- Checkboxes de Aceptación -->
        <div class="form-section">
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="aceptoPolitica">
              <span>Acepto la <a href="#" class="link">política de privacidad</a></span>
            </label>
          </div>

          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="aceptoDeclaracion">
              <span>Acepto la <a href="#" class="link">declaración jurada de veracidad de la información</a></span>
            </label>
          </div>
        </div>

        <!-- Botón de Enviar -->
        <div class="form-actions">
          <button 
            type="button" 
            (click)="submitDocument()" 
            class="btn btn-primary btn-large"
            [disabled]="documentForm.invalid || loading()">
            @if (loading()) {
              <span class="loading-spinner"></span>
              Enviando...
            } @else {
              Enviar
            }
          </button>
        </div>
      </form>
    }
  </div>
</div>
